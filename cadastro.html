<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Novo Processo</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 600px; margin: 20px auto; padding: 20px; background-color: #f8f9fa; }
        h2 { color: #333; text-align: center; }
        label { display: block; margin-top: 10px; font-weight: bold; font-size: 0.9em; color: #555; }
        input, select { width: 100%; padding: 10px; margin-top: 5px; border: 1px solid #ccc; border-radius: 5px; box-sizing: border-box; }
        button { width: 100%; padding: 15px; background-color: #28a745; color: white; border: none; border-radius: 5px; cursor: pointer; font-size: 16px; margin-top: 20px; font-weight: bold; }
        .back-link { display: block; margin-bottom: 20px; color: #007bff; text-decoration: none; font-weight: bold; }
        .row { display: flex; gap: 10px; }
        .col { flex: 1; }
    </style>
</head>
<body>

    <a href="index.html" class="back-link">â¬… Voltar ao Menu</a>
    <h2>Cadastrar Novo Processo</h2>
    
    <div class="row">
        <div class="col">
            <label>ðŸ“… Data da Venda (RelatÃ³rio)</label>
            <input type="date" id="dataVenda">
        </div>
        <div class="col">
            <label>ðŸ“‚ Data de Cadastro</label>
            <input type="date" id="dataProcesso">
        </div>
    </div>

    <label>Nome do Cliente</label>
    <input type="text" id="nome" placeholder="Ex: JoÃ£o da Silva">

    <div class="row">
        <div class="col">
            <label>NÃºmero da Proposta</label>
            <input type="text" id="proposta" placeholder="Ex: 123456">
        </div>
        <div class="col">
            <label>Corretor</label>
            <input type="text" id="corretor" placeholder="Nome do Corretor">
        </div>
    </div>

    <div class="row">
        <div class="col">
            <label>Valor do Contrato (R$)</label>
            <input type="number" id="valor" step="0.01" placeholder="0,00">
        </div>
        <div class="col">
            <label>Qtd. Vidas</label>
            <input type="number" id="vidas" placeholder="1">
        </div>
    </div>

    <div class="row">
        <div class="col">
            <label>Modalidade</label>
            <select id="modalidade">
                <option value="">Selecione...</option>
                <option value="PF">Pessoa FÃ­sica (PF)</option>
                <option value="PJ">Pessoa JurÃ­dica (PJ)</option>
                <option value="AdesÃ£o">AdesÃ£o</option>
            </select>
        </div>
        <div class="col">
            <label>Operadora</label>
            <select id="operadora">
                <option value="">Selecione...</option>
                <option value="Amil">Amil</option>
                <option value="Assim SaÃºde">Assim SaÃºde</option>
                <option value="Bradesco">Bradesco</option>
                <option value="Hapvida">Hapvida</option>
                <option value="Klini PME">Klini SaÃºde</option>
                <option value="Leve SaÃºde">Leve SaÃºde</option>
                <option value="MedSÃªnior">MedSÃªnior</option>
                <option value="Porto Seguro">Porto Seguro</option>
                <option value="Prevent SÃªnior">Prevent SÃªnior</option>
                <option value="QualiCorp">QualiCorp</option>
                <option value="Solutions">Solutions</option>
                <option value="SulAmÃ©rica">SulAmÃ©rica</option>
                <option value="Supermed">Supermed</option>
                <option value="Unimed">Unimed</option>
                <option value="Outros">Outros</option>
            </select>
        </div>
    </div>

    <label>Plano Contratado</label>
    <input type="text" id="plano" placeholder="Ex: Nacional Flex...">

    <label>Status Atual</label>
    <select id="status" style="background-color: #e8f0fe;">
        <option value="Enviado para aceite/DS">Enviado para aceite/DS</option>
        <option value="AnÃ¡lise">Em AnÃ¡lise</option>
        <option value="Pendente">Pendente</option>
        <option value="PendÃªncia Resolvida">PendÃªncia Resolvida</option>
        <option value="Proposta Liberada">Proposta Liberada</option>
        <option value="Boleto Liberado">Boleto Liberado</option>
        <option value="Implantado">Implantado (Vendido)</option>
        <option value="Cancelado">Cancelado</option>
    </select>
    
    <button id="btnSalvar">Salvar Processo</button>

    <script type="module">
        import { db } from './config.js';
        import { collection, addDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        // Preencher data de cadastro com hoje automaticamente
        document.getElementById("dataProcesso").valueAsDate = new Date();

        document.getElementById("btnSalvar").addEventListener("click", async () => {
            const nome = document.getElementById("nome").value;
            const proposta = document.getElementById("proposta").value;
            const dataProcesso = document.getElementById("dataProcesso").value; // Data Cadastro
            const dataVenda = document.getElementById("dataVenda").value;       // Data Venda (NOVO)
            const corretor = document.getElementById("corretor").value;
            const valor = document.getElementById("valor").value;
            const vidas = document.getElementById("vidas").value;
            const modalidade = document.getElementById("modalidade").value;
            const operadora = document.getElementById("operadora").value;
            const plano = document.getElementById("plano").value;
            const status = document.getElementById("status").value;

            if(nome === "" || proposta === "") { 
                alert("Preencha Nome e Proposta!"); 
                return; 
            }

            // Se o usuÃ¡rio nÃ£o preencher a data da venda, o sistema usa a data do cadastro como "quebra-galho"
            const dataVendaFinal = dataVenda || dataProcesso;

            try {
                await addDoc(collection(db, "processos"), {
                    nome: nome,
                    proposta: proposta,
                    dataProcesso: dataProcesso,
                    dataVenda: dataVendaFinal, // Salva o novo campo
                    corretor: corretor,
                    valor: valor,
                    vidas: vidas,
                    modalidade: modalidade,
                    operadora: operadora,
                    plano: plano,
                    status: status,
                    criadoEm: new Date()
                });
                
                alert("Salvo com sucesso!");
                window.location.href = "lista.html"; 
            } catch (e) {
                console.error(e);
                alert("Erro ao salvar: " + e.message);
            }
        });
    </script>
</body>
</html>
