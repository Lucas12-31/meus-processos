<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Editar Processo</title>
    <style>
        /* Mesmos estilos do cadastro para manter o padrão */
        body { font-family: Arial, sans-serif; max-width: 600px; margin: 20px auto; padding: 20px; background-color: #fff3cd; } /* Fundo amarelado para diferenciar */
        h2 { color: #333; text-align: center; }
        label { display: block; margin-top: 10px; font-weight: bold; font-size: 0.9em; color: #555; }
        input, select { width: 100%; padding: 10px; margin-top: 5px; border: 1px solid #ccc; border-radius: 5px; box-sizing: border-box; }
        
        button { width: 100%; padding: 15px; background-color: #007bff; color: white; border: none; border-radius: 5px; cursor: pointer; font-size: 16px; margin-top: 20px; font-weight: bold; }
        button:hover { background-color: #0056b3; }
        
        .back-link { display: block; margin-bottom: 20px; color: #007bff; text-decoration: none; font-weight: bold; }
        .row { display: flex; gap: 10px; }
        .col { flex: 1; }
    </style>
</head>
<body>

    <a href="lista.html" class="back-link">⬅ Cancelar e Voltar</a>
    <h2>✏️ Editar Processo</h2>
    
    <label>Data do Processo</label>
    <input type="date" id="dataProcesso">

    <label>Nome do Cliente</label>
    <input type="text" id="nome">

    <div class="row">
        <div class="col">
            <label>Número da Proposta</label>
            <input type="text" id="proposta">
        </div>
        <div class="col">
            <label>Corretor</label>
            <input type="text" id="corretor">
        </div>
    </div>

    <div class="row">
        <div class="col">
            <label>Valor do Contrato (R$)</label>
            <input type="number" id="valor" step="0.01">
        </div>
        <div class="col">
            <label>Qtd. Vidas</label>
            <input type="number" id="vidas">
        </div>
    </div>

    <div class="row">
        <div class="col">
            <label>Modalidade</label>
            <select id="modalidade">
                <option value="">Selecione...</option>
                <option value="PF">Pessoa Física (PF)</option>
                <option value="PJ">Pessoa Jurídica (PJ)</option>
                <option value="Adesão">Adesão</option>
            </select>
        </div>
        <div class="col">
            <label>Operadora</label>
            <select id="operadora">
                <option value="">Selecione...</option>
                <option value="Amil">Amil</option>
                <option value="Assim Saúde">Assim Saúde</option>
                <option value="Bradesco">Bradesco</option>
                <option value="Hapvida">Hapvida</option>
                <option value="Klini PME">Klini Saúde</option>
                <option value="Leve Saúde">Leve Saúde</option>
                <option value="MedSênior">MedSênior</option>
                <option value="Porto Seguro">Porto Seguro</option>
                <option value="Prevent Sênior">Prevent Sênior</option>
                <option value="QualiCorp">QualiCorp</option>
                <option value="Solutions">Solutions</option>
                <option value="SulAmérica">SulAmérica</option>
                <option value="Supermed">Supermed</option>
                <option value="Unimed">Unimed</option>
                <option value="Outros">Outros</option>
            </select>
        </div>
    </div>

    <label>Plano Contratado</label>
    <input type="text" id="plano">

    <label>Status Atual</label>
    <select id="status">
        <option value="Enviado para aceite/DS">Enviado para aceite/DS</option>
        <option value="Análise">Em Análise</option>
        <option value="Pendente">Pendente</option>
        <option value="Pendência Resolvida">Pendência Resolvida</option>
        <option value="Proposta Liberada">Proposta Liberada</option>
        <option value="Boleto Liberado">Boleto Liberado</option>
        <option value="Implantado">Implantado (Vendido)</option>
        <option value="Cancelado">Cancelado</option>
    </select>
    
    <button id="btnAtualizar">Salvar Alterações</button>

    <script type="module">
        import { db } from './config.js';
        import { doc, getDoc, updateDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        // 1. PEGAR O ID DA URL (Ex: editar.html?id=123)
        const params = new URLSearchParams(window.location.search);
        const id = params.get('id');

        if (!id) {
            alert("Erro: Nenhum processo selecionado.");
            window.location.href = "lista.html";
        }

        // 2. BUSCAR DADOS NO BANCO E PREENCHER A TELA
        async function carregarDados() {
            const docRef = doc(db, "processos", id);
            const docSnap = await getDoc(docRef);

            if (docSnap.exists()) {
                const dados = docSnap.data();
                
                // Preenche os campos com o que veio do banco
                document.getElementById("nome").value = dados.nome || "";
                document.getElementById("proposta").value = dados.proposta || "";
                document.getElementById("dataProcesso").value = dados.dataProcesso || "";
                document.getElementById("corretor").value = dados.corretor || "";
                document.getElementById("valor").value = dados.valor || "";
                document.getElementById("vidas").value = dados.vidas || "";
                document.getElementById("modalidade").value = dados.modalidade || "";
                document.getElementById("operadora").value = dados.operadora || "";
                document.getElementById("plano").value = dados.plano || "";
                document.getElementById("status").value = dados.status || "";

            } else {
                alert("Processo não encontrado!");
                window.location.href = "lista.html";
            }
        }

        carregarDados(); // Roda assim que a página abre

        // 3. SALVAR ALTERAÇÕES (UPDATE)
        document.getElementById("btnAtualizar").addEventListener("click", async () => {
            try {
                const docRef = doc(db, "processos", id);
                
                await updateDoc(docRef, {
                    nome: document.getElementById("nome").value,
                    proposta: document.getElementById("proposta").value,
                    dataProcesso: document.getElementById("dataProcesso").value,
                    corretor: document.getElementById("corretor").value,
                    valor: document.getElementById("valor").value,
                    vidas: document.getElementById("vidas").value,
                    modalidade: document.getElementById("modalidade").value,
                    operadora: document.getElementById("operadora").value,
                    plano: document.getElementById("plano").value,
                    status: document.getElementById("status").value
                });

                alert("Atualizado com sucesso!");
                window.location.href = "lista.html";

            } catch (e) {
                console.error(e);
                alert("Erro ao atualizar: " + e.message);
            }
        });
    </script>
</body>
</html>
